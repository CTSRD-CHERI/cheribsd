#
# CHERI -- Kernel for the SRI/Cambridge "CHERI" (Capability Hardware Enhanced
# RISC Instructions) FPGA soft core, as configured in its Terasic DE-4
# reference configuration - 128bit version.
#
# $FreeBSD$
#

include		"BERI_DE4_BASE"
ident		CHERI128_PURECAP_DE4_MDROOT

include		"std.CHERI128"

machine		mips mips64c128

makeoptions	EMBED_CHERITEST_LIST=YES

nomakeoptions 	ARCH_FLAGS
makeoptions	ARCH_PIC_FLAGS="-fpic"
makeoptions	ARCH_FLAGS="-target cheri-unknown-freebsd -march=mips64 -cheri=128 -cheri-cap-table-abi=plt -mxcaptable -Xclang -cheri-bounds=subobject-safe"
makeoptions	CFLAGS+="-gdwarf-5"
makeoptions	WERROR="-Wno-error"
makeoptions 	KERNLOADADDR=0xffffffff80100000

nooptions	SMP

# purecap kernel options
options		CHERI_PURECAP_KERNEL
nooptions	CHERI_IMPLICIT_USER_DDC

# kernel modules
options 	TMPFS
options		FFS
options		CD9660
nooptions	MSDOSFS
nooptions	NFSD, NFSCL

# disable raid, we don't need it
nooptions	GEOM_RAID

# networking
options		INET6
device		tuntap

# debugging
options 	KTRACE
options 	KDB
options		KDB_TRACE # stacktrace on panic
nooptions	DDB

options		DIAGNOSTIC
options		VERBOSE_SYSINIT
options		BOOTVERBOSE=1
options		STACK
options		WITNESS
options		DEBUG_VFS_LOCKS

# no BPF support
nodevice bpf

# disable usb for now
nodevice usb
nodevice saf1761otg
nodevice ukbd
nodevice ums

# disable raid, we don't need it
nooptions	GEOM_RAID

#
# This kernel configuration uses an embedded 8MB memory root file system.
# Adjust the following path based on local requirements.
#
options 	MD_ROOT			# MD is a potential root device
options 	MD_ROOT_SIZE=92160	# 90MB
options 	ROOTDEVNAME=\"ufs:md0\"

# XXX: MD_ROOT_SIZE and MFS_IMAGE are mutually exclusive.  When adding an
# MFS_IMAGE entry comment out "options MD_ROOT_SIZE" or uncomment the
# following line.
#nooptions	MD_ROOT_SIZE
#makeoptions	MFS_IMAGE=/foo/baz/baz/mdroot.img

nodevice xdma
nodevice altera_softdma
nodevice altera_msgdma
nodevice altera_atse
