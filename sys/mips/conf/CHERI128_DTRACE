# CHERI128_DTRACE -- 64-bit kernel config for with DTrace support
#
# $FreeBSD$

ident           CHERI128_DTRACE

include         "std.MALTA"
include         "std.CHERI128"

machine         mips mips64     # Malta supports both, so it isn't in std.malta

makeoptions     KERNLOADADDR=0xffffffff80100000

makeoptions     DEBUG="-g"
makeoptions     WITH_CTF=1
# TODO(nicomazz) compile dtrace test into kernel, to avoid fixing modules
# makeoptions     MODULES_OVERRIDE="dtrace/dtrace_test dtrace/dtraceall"

options         KTRACE

options NO_SWAPPING

#debug things
options KDB
options DDB
options KDB_TRACE
options DDB_NUMSYM
options GDB
options KTR

#
# Features required for CHERI CPU and CheriBSD support.
#
options         KSTACK_LARGE_PAGE
options         TMPFS

#
# Qemu-CHERI tracing is permitted per thread, not just globally.
#
options         CPU_QEMU_MALTA

options         KDTRACE_FRAME
options         KDTRACE_HOOKS
options DDB_CTF

device       dtrace
device       dtrace_systrace
device       dtrace_sdt
device       dtrace_prototype
device       dtrace_fbt
device       dtrace_profile
device       dtraceall


# Access host files on QEMU
options 	SMBFS
options 	NETSMB			# Seems to be needed by SMBFS
options 	LIBMCHAIN		# Also seems to be needed by SMBFS
options 	LIBICONV		# Also seems to be needed by SMBFS
