# CHERI_PURECAP_MALTA64 -- 64-bit purecap ABI kernel config for MALTA boards + 256-bit CHERI
#
# $FreeBSD$
 
ident		CHERI_PURECAP_MALTA64

include		"std.MALTA"
include		"std.CHERI"
 
hints		"CHERI_MALTA64.hints"  #Default places to look for devices.

machine		mips mips64	# Malta supports both, so it isn't in std.malta

nomakeoptions 	ARCH_FLAGS
makeoptions	ARCH_PIC_FLAGS="-fpic"
makeoptions	ARCH_FLAGS="-target cheri-unknown-freebsd -march=mips64 -mabi=purecap -cheri=256 -cheri-cap-table-abi=plt -mxcaptable -Xclang -cheri-bounds=subobject-safe -cheri-uintcap=offset"
makeoptions	CFLAGS+="-gdwarf-5"
makeoptions	WERROR="-Wno-error"
makeoptions 	KERNLOADADDR=0xffffffff80100000

# purecap kernel options
options		CHERI_PURECAP_KERNEL
options 	KSTACK_LARGE_PAGE
nooptions	CHERI_IMPLICIT_USER_DDC

# kernel modules
options 	TMPFS
options		FFS
options		CD9660
nooptions	MSDOSFS
nooptions	NFSD, NFSCL

# disable raid, we don't need it
nooptions	GEOM_RAID

# debugging
options 	KTRACE
options 	KDB
options		KDB_TRACE # stacktrace on panic
nooptions	DDB

options		DIAGNOSTIC
options		VERBOSE_SYSINIT
options		BOOTVERBOSE=1
# options	BUS_DEBUG
# options	CAMDEBUG
# options	CAM_DEBUG_FLAGS=3
options		STACK
options		WITNESS
options		DEBUG_VFS_LOCKS
# options	TRAP_DEBUG
# options	KTR
# options	KTR_VERBOSE=2
# nooptions	KTR_ALQ
# options	LOCK_DEBUG

#
# Qemu-CHERI tracing is permitted per thread, not just globally.
#
options 	CPU_QEMU_MALTA

# Qemu doesn't yet support these
nooptions	CPU_CHERI_HW_CCALL_CHECKS
nooptions	CPU_CHERI_HW_CCLEAR

# support for virtio rng device
device		virtio
device		virtio_pci

device		tuntap
