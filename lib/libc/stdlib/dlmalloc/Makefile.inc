# $FreeBSD$

.PATH: ${LIBC_SRCTOP}/stdlib/dlmalloc
.PATH: ${SRCTOP}/contrib/dlmalloc

DLMALLOCSRCS:= dlmalloc_nonreuse.c dlmalloc_libc_stubs.c

SYM_MAPS+=${LIBC_SRCTOP}/stdlib/dlmalloc/Symbol.map

CFLAGS+=-I${SRCTOP}/contrib/dlmalloc

.if ${MK_CHERI} == "yes"
DLMALLOC_CFLAGS+=	-DCHERI_SET_BOUNDS -DSAFE_FREEBUF
DLMALLOC_CFLAGS+=	-DCAPREVOKE -DDEFAULT_MAX_FREEBUFBYTES=8388608
DLMALLOC_CFLAGS+=	-DDCONSOLIDATE_ON_FREE=1
DLMALLOC_CFLAGS+=	-DZERO_MEMORY=0
DLMALLOC_CFLAGS+=	-DSUPPORT_UNMAP=1
.endif

SRCS+=	${DLMALLOCSRCS}
